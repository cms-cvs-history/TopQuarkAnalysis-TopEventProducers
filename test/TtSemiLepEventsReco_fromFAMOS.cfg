process TtEventReco  = {
	
	# initialize MessageLogger
   	  include "FWCore/MessageLogger/data/MessageLogger.cfi"
   	  replace MessageLogger.cerr.threshold = "WARNING"


        ### FAMOS ###

          untracked PSet maxEvents = {untracked int32 input = 100}
    
          service =  RandomNumberGeneratorService {
            # This is to initialize the random engine of the source
            untracked uint32 sourceSeed = 123456789
            # This is to initialize the random engines of Famos
            PSet moduleSeeds = {
              untracked uint32 VtxSmeared = 123456789
              untracked uint32 famosSimHits = 13579
              untracked uint32 siTrackerGaussianSmearingRecHits = 24680
              untracked uint32 caloRecHits = 654321
              untracked uint32 paramMuons = 54525
            }
          }
    
          # Generate ttbar events
          include "FastSimulation/Configuration/data/ttbar.cfi"

          # Famos sequences
          include "FastSimulation/Configuration/data/FamosSequences.cff"
          // Parametrized magnetic field
          replace VolumeBasedMagneticFieldESProducer.useParametrizedTrackerField = true
          // You may not want to simulate everything for your study
          replace famosSimHits.SimulateCalorimetry = true
          replace famosSimHits.SimulateTracking = true
          replace famosSimHits.SimulatePileUp = true
          replace famosSimHits.SimulateMuons = true

          # Tracker MisAlignement 
          # include "FastSimulation/Configuration/data/MisAlignment.cff" 
          # ECAL miscalibration. 
          # include "FastSimulation/Configuration/data/MisCalibration.cff"


        ### TQAF ###

	# Construct the MC Generated Ttbar Event
	  include "TopQuarkAnalysis/TopEventProducers/data/TtGenEvtProducer.cff"
	
	# filter a specific decay chain
	  include "TopQuarkAnalysis/TopEventProducers/data/TtSemiLeptonicFilter.cfi"
	  
	# perform high level reco tasks
	  include "TopQuarkAnalysis/TopObjectProducers/data/HighLevelReco.cff"

	# build the TopObjects (TopJets, TopMuons, TopElectrons, TopMETs)
	  include "TopQuarkAnalysis/TopObjectProducers/data/TopObjectProducers.cff"
	  
        # apply a kinematic selection on the TopObjects
	  include "TopQuarkAnalysis/TopEventProducers/data/TtSemiObjectSelection.cff"
   
        # TtSemiEvt solutions
	  include "TopQuarkAnalysis/TopEventProducers/data/TtSemiEvtSolProducer.cfi"
          //replace solutions.matchToGenEvt = false
	  replace solutions.addLRSignalSel = true
	  replace solutions.addLRJetComb   = true
	

        ### FAMOS replace statements ###

          // to use gsTracks
          replace jetTracksAssociator.tracks = gsWithMaterialTracks
          replace allLayer1TopBJets.trackAssociation.tracks = gsWithMaterialTracks
          replace allLayer1TopLJets.trackAssociation.tracks = gsWithMaterialTracks
          replace allLayer1TopLJets.tracks = gsWithMaterialTracks
          replace allLayer1TopBJets.tracks = gsWithMaterialTracks
          replace allLayer1TopElectrons.tracks = gsWithMaterialTracks
          replace allLayer1TopMuons.tracks = gsWithMaterialTracks
          replace allLayer1TopTaus.tracks = gsWithMaterialTracks
          // to use Famos muons
          replace allLayer1TopMETs.muonSource = "paramMuons:ParamGlobalMuons"
          replace allLayer1TopMuons.muonSource = "paramMuons:ParamGlobalMuons"
          replace MCJetCorJetFastjet10.src = fastjet10CaloJets
          replace MCJetCorJetFastjet6.src  = fastjet6CaloJets

        ### Output ###

          module out = PoolOutputModule {
            untracked string fileName = "TtSemiMuEvents.root"
            untracked vstring outputCommands = {
              "drop *",
              "keep *_*_*_TtEventReco"
            }
            untracked bool verbose = false
          }

	path p = {makeGenEvt, ttSemiLeptonicFilter, highLevelReco, allTopObjects, objectSelection, solutions}

        endpath outpath = { out }	

}
