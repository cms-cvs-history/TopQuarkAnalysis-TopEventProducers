process StEventReco  = {
	
	# initialize MessageLogger
   	  include "FWCore/MessageLogger/data/MessageLogger.cfi"
   	  replace MessageLogger.cout.threshold = "DEBUG"

   	# input file
### This accesses files existing only in Bruxelles machines:
#  	  include "TopQuarkAnalysis/TopObjectProducers/data/RecoInput.cfi"
### This exists only in my private area (Andrea):
#  	  include "TopQuarkAnalysis/TopEventProducers/data/SingleTop_muons.cfi"
#	  replace PoolSource.maxEvents = 30

### Just to test on a sample interactively at CERN:
	source = PoolSource {
          untracked vstring fileNames = {
		'/store/RelVal/2007/3/30/SVSuite130MET-ZjetsDimuons-DIGI-RECO/0000/BA4709FA-2EDF-DB11-8809-000E0C3F07F5.root'
	  }
	  untracked int32 maxEvents = 30
	}



	# Construct the MC Generated Single Top Event, and filter a specific decay chain
	  include "TopQuarkAnalysis/TopEventProducers/data/StGenEvtProducer.cfi"
	  #include "TopQuarkAnalysis/TopEventProducers/data/TtGenEvtDecayFilter.cfi" temporarily disabled... I will write a StGenEvtDecayFilter.cfi

	# build the TopObjects (TopJets, TopMuons, TopElectrons, TopMETs)
	  include "TopQuarkAnalysis/TopObjectProducers/data/TopObjectReconstruction.cfi"
	  replace TopJetObjects.jetEtacut = 5.0   # we need the high-rapidity jets!  

        # module to make evt solutions
          module solutions = StEvtSolutionMaker {
	    string leptonFlavour  = 'muon' 	//electron or muon
	    string jetInput	  = 'TopJetObjects'
	    bool matchToGenEvt    = false  # it works on signal, but it crashes on ZjetsDimuons / to be fixed!
	    bool doKinFit   	  = true
	    int32 maxNrIter       = 200
	    double maxDeltaS      = 5e-5
	    double maxF           = 1e-4
	    int32 parametrisation = 3		//1: EtEtaPhi, 2:EtThetaPhi, 3:EMom
### TO BE UNDERSTOOD: modes 1 and 2 give singular matrices!
	    vint32 constraints    = {1,2}	//1: Wlep, 2:tlep, 3:nu-mass
	    bool addJetCombProb   = false
	  } 
	  
	  
	
	# output
          module out = PoolOutputModule {
            untracked string fileName = "SingleTopMuEvents.root"
            untracked vstring outputCommands = {
              "drop *",
              "keep *_*_*_TopObjects",
              "keep *_*_*_StEventReco"
            }
            untracked bool verbose = false
          }

#	path p = {genEvt,genTtDecaySel, buildTopObjects, solutions} # to do: genStDecaySel
	path p = {genEvt, buildTopObjects, solutions}
        endpath outpath = { out }	
}
